<!DOCTYPE html>
<html lang="{{language_code}}">
<head>
    {{> partials/basicmeta }}
    <title>SmileBASIC Source Image Browser</title>
    <meta name="description" content="Simple image browser widget">
    <!-- Keep in mind how many places may want the default colors, basic classes, etc. 
        We may need a css for the colors and classes, and another for layout structure
        with forms and stuff. Oh wait, there it is: base.css -->
    {{stylesheet "/base.css"}}
    <style>
        html {
            height: 100%;
        }
        /* Since style is JUST for this widget, just include it directly */
        body {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            margin: 0;
            /* Let the parent figure out the padding on their side */
            padding: 0;
            /*padding: 0.5em;*/ 
            box-sizing: border-box;
            overflow-x: hidden;
            overflow-y: hidden;
            background-color: var(--bg_section);
            font-family: var(--font);
        }
        h3 {
            margin: 0;
            margin-bottom: 0.5em;
        }
        #browseform {
            display: flex;
            flex-wrap: wrap;
            padding: 0.5em 0.75em;
            background-color: var(--color_divider);
            border-radius: 0.5em;
        }
        #browseform > * {
            margin: 0.25em 0;
            margin-right: 0.3em;
        }
        #browsepagenav {
            display: flex;
            justify-content: center;
            margin: 0.5em;
        }
        .imagelist {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-end;
            justify-content: space-evenly;
        }
        .imagelist > * {
            margin: 0.2em;
        }
        .imagepreview {
            display: flex;
            flex-direction: column;
        }
        [data-size="1"] .imagepreview { width: 100px; }
        [data-size="1"] .imagepreview input { font-size: 0.6em; }
        [data-size="2"] .imagepreview { width: 200px; }
        [data-size="3"] .imagepreview { width: 300px; }
    </style>
</head>
<body data-size="{{search.size}}">
    <!-- This is meant to go in an iframe, so it will use the entire space -->
    <h3>Upload file:</h3>
    <!-- Still technically a self post but we need to preserve the entirety of 
        the -->
    <form method="POST" action="{{http_root}}{{route_uri}}">
        {{> partials/errorlist }}
        <input id="fileinput" type="file" name="file" class="largeinput" accept="image/*">
        <input type="submit" value="Upload">
    </form>
    <hr>
    <h3>Browse files:</h3>
    <div class="scrollable">
        <!-- Don't include an action so it just posts to the same url but with the form as params -->
        <form method="GET" id="browseform">
            <label for="search-oldest" class="inline">
                <span>Oldest first:</span>
                <input id="search-oldest" type="checkbox" name="oldest" value="true" {{#if search.oldest}}checked=""{{/if}}>
            </label>
            <label for="search-all" class="inline">
                <span>Global search:</span>
                <input id="search-all" type="checkbox" name="global" value="true" {{#if search.global}} checked=""{{/if}}>
            </label>
            <label for="search-size" class="inline">
                <span>Size:</span>
                <select id="search-size" value="{{search.size}}" name="size">
                    {{> partials/optionlist options=sizevalues}}
                </select>
            </label>
            <label for="search-preview" class="inline">
                <span>Preview:</span>
                <input id="search-preview" type="text" class="largeinput" name="preview" value="{{search.preview}}" placeholder="Comma separated hashes">
            </label>
            <input type="submit" value="Update search">
        </form>
        {{#*inline "img_b"}}
        {{#each images}}
        <div class="imagepreview">
            <img src="{{imagelink hash ../imagesize}}">
            <input readonly="" value="{{hash}}" title="{{hash}}">
        </div>
        {{/each}}
        {{/inline}}
        {{#*inline "img_nav"}}
        <div id="browsepagenav" class="smallseparate">
            {{#if previouspagelink}}
            <a href="{{http_root}}{{previouspagelink}}" class="plainlink">Previous</a>
            {{/if}}
            {{#if hasimages}}
            <a href="{{http_root}}{{nextpagelink}}" class="plainlink">Next</a>
            {{/if}}
        </div>
        {{/inline}}
        {{#if haspreview}}
        <b>Preview images: {{imagesize}}</b>
        <div class="imagelist">
            {{> img_b images=previewimages}}
        </div>
        <hr>
        {{/if}}
        {{> img_nav }}
        <div class="imagelist">
            {{> img_b }}
        </div>
        {{#if hasimages}}
        {{> img_nav }}
        {{/if}}
    </div>
</body>
</html>